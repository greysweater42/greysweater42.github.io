<!DOCTYPE html>
<html lang="en">
<head>

  <title>greysweater42&#39;s cookbook</title>
  <link rel="shortcut icon" type='image/x-icon' href="https://greysweater42.github.io/favicon.ico"/> 

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link href="https://fonts.googleapis.com/css?family=Ubuntu&display=swap" rel="stylesheet">        
  <link href="https://fonts.googleapis.com/css?family=Ubuntu+Mono&display=swap" rel="stylesheet">

  <link href="https://fonts.googleapis.com/css?family=Fascinate&display=swap" rel="stylesheet">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
  
  
  <link rel="stylesheet" href="https://greysweater42.github.io/css/bootstrap-toc.css">

  
  <link rel="stylesheet" href="https://greysweater42.github.io/css/darcula.css">

  
  <link rel="stylesheet" href="https://greysweater42.github.io/css/style.css">

  
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-NNMCY8RRGL"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-NNMCY8RRGL');
  </script>

</head>


<body data-spy="scroll" data-target="#toc">



<nav id="navbar" class="navbar navbar-expand-md fixed-top navbar-hide transition">

  
  <a class="navbar-brand"></a>

  <button class="navbar-toggler float-xs-right" data-toggle="collapse" data-target="#collapsibleNavbar">
    Menu
  </button>

  <div class="collapse navbar-collapse" id="collapsibleNavbar">

    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="https://greysweater42.github.io">Home</a>
      </li>
      
      
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown">Python</a>
        <div class="dropdown-menu scrollable-menu">
          
            <a class="dropdown-item" href="https://greysweater42.github.io/airflow/">airflow</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/async_thread/">async/threads</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/beautiful_soup/">beautiful soup</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/decorators/">decorators</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/fastai/">fastai</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/flask/">flask</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/ggplot2/">ggplot2</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/keras/">keras</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/learning_tensorflow/">learning tensorflow</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/logging/">logging</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/pandas/">pandas</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/pillow/">pillow</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/pyenv/">pyenv, virtualenv, freeze</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/pytorch/">pytorch</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/pytorch_basics/">pytorch basics</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/spark/">spark</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/sqlalchemy/">sqlAlchemy</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/tensorflow/">tensorflow</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/testing/">testing</a>
          
        </div>
      </li>
    
      
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown">R</a>
        <div class="dropdown-menu scrollable-menu">
          
            <a class="dropdown-item" href="https://greysweater42.github.io/cinr/">C in R</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/classess4/">classes - S4</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/data.table/">data.table</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/debugging/">debugging</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/decision_trees/">decision trees</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/ggplot2/">ggplot2</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/logging/">logging</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/lubridate/">lubridate</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/nls/">nls</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/packages/">packages</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/rcpp/">Rcpp</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/reshape2/">reshape2</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/rmariadb/">RMariaDB (former RMySQL)</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/rocker/">rocker</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/rstanarm/">rstanarm</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/rtags/">rTags</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/shiny/">shiny</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/spark/">spark</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/sqldf/">sqldf</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/testing/">testing</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/tidyverse/">tidyverse</a>
          
        </div>
      </li>
    
      
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown">Machine learning</a>
        <div class="dropdown-menu scrollable-menu">
          
            <a class="dropdown-item" href="https://greysweater42.github.io/ml/">basic machine learning algorithms</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/bayes/">bayes</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/bias_variance/">bias/variance trade-off</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/cnns/">CNNs</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/decision_trees/">decision trees</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/fastai/">fastai</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/fourier/">Fourier transform</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/keras/">keras</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/learning_tensorflow/">learning tensorflow</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/validation/">model validation</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/nlp/">nlp</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/nls/">nls</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/pca/">PCA / SVD</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/pillow/">pillow</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/pytorch/">pytorch</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/pytorch_basics/">pytorch basics</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/tensorflow/">tensorflow</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/useful_processing/">useful processing</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/xai/">XAI</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/xgboost/">xgboost</a>
          
        </div>
      </li>
    
      
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown">Data engineering</a>
        <div class="dropdown-menu scrollable-menu">
          
            <a class="dropdown-item" href="https://greysweater42.github.io/airflow/">airflow</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/async_thread/">async/threads</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/hadoop/">hadoop</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/logging/">logging</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/pandas/">pandas</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/rabbimtmq/">RabbimtMQ</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/spark/">spark</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/terraform_bigquery/">terraform &#43; bigquery</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/useful_processing/">useful processing</a>
          
        </div>
      </li>
    
      
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown">DevOps</a>
        <div class="dropdown-menu scrollable-menu">
          
            <a class="dropdown-item" href="https://greysweater42.github.io/bash/">bash</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/docker/">docker</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/docker_compose_boilerplate/">docker-compose biolerplate</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/flask/">flask</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/git/">git</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/heroku/">heroku</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/kubernetes/">Kubernetes</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/mesos/">mesos</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/pyenv/">pyenv, virtualenv, freeze</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/rocker/">rocker</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/terraform_bigquery/">terraform &#43; bigquery</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/terraform_ec2_vpc/">terraform &#43; EC2 &#43; VPC</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/vagrant/">vagrant</a>
          
        </div>
      </li>
    
      
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown">Projects</a>
        <div class="dropdown-menu scrollable-menu">
          
            <a class="dropdown-item" href="https://greysweater42.github.io/fiat_ferrari/">fiat 126 v ferrari</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/finance_nn/">neural networks vs stock market</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/reading_mate/">reading mate</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/vim_vs_emacs/">vim vs emacs - text mining to settle the editor war</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/cookbook/">writing a cookbook</a>
          
        </div>
      </li>
    
      
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown">scratchpad</a>
        <div class="dropdown-menu scrollable-menu">
          
            <a class="dropdown-item" href="https://greysweater42.github.io/passing_arguments/">passing arguments to scripts</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/redis/">redis</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/tensorflow_serving/">tensorflow_serving</a>
          
        </div>
      </li>
    
    </ul>

  </div>  

</nav>



<div class="jumbotron text-center" id="header">

  <div id="header-title">
      <a href="https://greysweater42.github.io">greysweater42&#39;s cookbook</a>
  </div>

  <p style="color: white;">data science tutorials and snippets prepared by greysweater42</p> 

</div>


<nav id="toc" data-toggle="toc" class="sticky-top d-none d-xl-block"></nav>

<div class="article">

<div class="article-categories">
  
    <object style="vertical-align:middle" type="image/svg+xml" data="/folder.svg" height="15px" width="15px"></object> 
    <a href="https://greysweater42.github.io/categories/python" role="button">Python </a>
    &emsp;
  
    <object style="vertical-align:middle" type="image/svg+xml" data="/folder.svg" height="15px" width="15px"></object> 
    <a href="https://greysweater42.github.io/categories/data-engineering" role="button">Data engineering </a>
    &emsp;
  </br>
</div>
<div class="article-title">
  
  pandas

</div>
<div class="article-info">
    Jan 25, 2019 &emsp;  &emsp; 9 minutes read
</div>




<div id="what-is-pandas-and-why-would-you-use-it" class="section level2">
<h2>1. What is <code>pandas</code> and why would you use it?</h2>
<ul>
<li><p><code>pandas</code> is probably your first choice for working with tabular data in Python. True, there is also <a href="https://datatable.readthedocs.io/en/latest/">datatable</a>, but it’s nowhere near as popular as pandas.</p></li>
<li><p>Effectively it is the only reasonable Python package for this purpose, which makes Python a little modest comparing to R (base, data.table, dplyr - every one of them has a better interface than pandas) for table processing.</p></li>
</ul>
<p>Personally I find <code>pandas</code> a tool that:</p>
<ul>
<li><p>makes any task moderately-simple. This may be an advantage for difficult tasks, but for everyday use is slightly frustrating.</p></li>
<li><p>has weird defaults, e.g.:</p>
<ul>
<li><p><code>write_csv</code> has <code>index=True</code> by default. Who would want that? Especially that <code>read_csv</code> does not read the column <code>index</code> as index.</p></li>
<li><p><code>groupby</code> has <code>as_index=True</code> by default, which creates MultiIndexes, which seem to be completely useless (or is it just me who doesn’t use them?)</p></li>
</ul></li>
</ul>
<p>Even though I use pandas almost every day, there are certain solutions that I constantly forget about. Here’s this short blog post with useful snippets.</p>
</div>
<div id="snippets" class="section level2">
<h2>2. Snippets</h2>
<div id="datetime" class="section level3">
<h3>datetime</h3>
<p>Let’s work on a simple dataframe:</p>
<pre class="python"><code>import pandas as pd

df = pd.DataFrame(dict(event_id=[1, 2], time=[&quot;2020-01-01 12:00&quot;, &quot;2020-01-02 12:00&quot;]))
print(df)</code></pre>
<pre><code>##    event_id              time
## 0         1  2020-01-01 12:00
## 1         2  2020-01-02 12:00</code></pre>
<pre class="python"><code>print(df.info())</code></pre>
<pre><code>## &lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
## RangeIndex: 2 entries, 0 to 1
## Data columns (total 2 columns):
##  #   Column    Non-Null Count  Dtype 
## ---  ------    --------------  ----- 
##  0   event_id  2 non-null      int64 
##  1   time      2 non-null      object
## dtypes: int64(1), object(1)
## memory usage: 160.0+ bytes
## None</code></pre>
<p>The first thing that you should do is converting the string in to datetime:</p>
<pre class="python"><code>df[&quot;time&quot;] = pd.to_datetime(df[&quot;time&quot;])
print(df)</code></pre>
<pre><code>##    event_id                time
## 0         1 2020-01-01 12:00:00
## 1         2 2020-01-02 12:00:00</code></pre>
<pre class="python"><code>print(df.info())</code></pre>
<pre><code>## &lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
## RangeIndex: 2 entries, 0 to 1
## Data columns (total 2 columns):
##  #   Column    Non-Null Count  Dtype         
## ---  ------    --------------  -----         
##  0   event_id  2 non-null      int64         
##  1   time      2 non-null      datetime64[ns]
## dtypes: datetime64[ns](1), int64(1)
## memory usage: 160.0 bytes
## None</code></pre>
<p>which provides interesting methods available with <code>.dt</code></p>
<pre class="python"><code>print(df[&quot;time&quot;].dt.date)</code></pre>
<pre><code>## 0    2020-01-01
## 1    2020-01-02
## Name: time, dtype: object</code></pre>
<pre class="python"><code>print(df[&quot;time&quot;].dt.year)</code></pre>
<pre><code>## 0    2020
## 1    2020
## Name: time, dtype: int64</code></pre>
<p><code>to_datetime</code> creates objects of type <code>pandas.Timestamp</code>, which have interesting methods described in <a href="https://pandas.pydata.org/docs/reference/api/pandas.Timestamp.html">pandas docs</a>, like <code>replace</code>:</p>
<pre class="python"><code>print(type(df[&quot;time&quot;][0]))</code></pre>
<pre><code>## &lt;class &#39;pandas._libs.tslibs.timestamps.Timestamp&#39;&gt;</code></pre>
<pre class="python"><code>new_times = df[&quot;time&quot;].map(lambda x: x.replace(month=2, year=2021))
print(new_times)</code></pre>
<pre><code>## 0   2021-02-01 12:00:00
## 1   2021-02-02 12:00:00
## Name: time, dtype: datetime64[ns]</code></pre>
<p>Filtering is rather straightforward:</p>
<pre class="python"><code>print(df[&quot;time&quot;] &gt; &quot;2020-01-02 00:01&quot;)
# but if you want to be meticulous, you can do it with</code></pre>
<pre><code>## 0    False
## 1     True
## Name: time, dtype: bool</code></pre>
<pre class="python"><code>print(df[&quot;time&quot;] &gt; pd.Timestamp(2020, 1, 2, 0, 1))</code></pre>
<pre><code>## 0    False
## 1     True
## Name: time, dtype: bool</code></pre>
<p>To sum up: you should convert your datetime strings to <code>pandas.Timestamp</code> with <code>pd.to_datetime</code>. Since then you have two possible types of operations:</p>
<ul>
<li><p>using <code>.dt</code> property, which may be useful for filtering,</p></li>
<li><p>using <code>.map</code> and <code>lambda</code> for manipulating <code>pd.Timestamp</code> objects one by one.</p></li>
</ul>
</div>
<div id="grouping-and-aggregation" class="section level3">
<h3>grouping and aggregation</h3>
<p>or a task that you would expect should be easy enough, yet in pandas it is not.</p>
<p>Let’s define a simple dataframe…</p>
<pre class="python"><code>import numpy as np
import pandas as pd

df = pd.DataFrame({
    &quot;event_id&quot;: [1, 1, 2, 2, 2],
    &quot;result&quot;: [12, 10, 15, 11, np.nan],
    &quot;comment&quot;: [&quot;good&quot;, &quot;bad&quot;, &quot;good&quot;, &quot;good&quot;, &quot;bad&quot;]
})
print(df)</code></pre>
<pre><code>##    event_id  result comment
## 0         1    12.0    good
## 1         1    10.0     bad
## 2         2    15.0    good
## 3         2    11.0    good
## 4         2     NaN     bad</code></pre>
<p>…and group it by the column “event_id”:</p>
<pre class="python"><code>grouped = df.groupby(&quot;event_id&quot;)
print(type(grouped))</code></pre>
<pre><code>## &lt;class &#39;pandas.core.groupby.generic.DataFrameGroupBy&#39;&gt;</code></pre>
<p>The resulting object is of type <code>DataFrameGroupBy</code> and has an interesting property: we can iterate over it:</p>
<pre class="python"><code>for g in grouped:
    print(g)</code></pre>
<pre><code>## (1,    event_id  result comment
## 0         1    12.0    good
## 1         1    10.0     bad)
## (2,    event_id  result comment
## 2         2    15.0    good
## 3         2    11.0    good
## 4         2     NaN     bad)</code></pre>
<p>Interestingly, each item is a tuple of <code>(id, df_sub)</code>, where <code>id</code> is the name of the column, by which we group, and <code>df_sub</code> is a subset of <code>df</code>, where <code>df[df.id == i]</code> and <code>i</code> is one of <code>set(df["id"])</code>. For many grouping columns though, the things get even more interesting:</p>
<pre class="python"><code>grouped = df.groupby([&quot;event_id&quot;, &quot;comment&quot;])
for (event_id, comment), df_sub in grouped:
    print(f&quot;df for event_id: {event_id} and comment: {comment}:&quot;)
    print(df_sub, &quot;\n&quot;)</code></pre>
<pre><code>## df for event_id: 1 and comment: bad:
##    event_id  result comment
## 1         1    10.0     bad 
## 
## df for event_id: 1 and comment: good:
##    event_id  result comment
## 0         1    12.0    good 
## 
## df for event_id: 2 and comment: bad:
##    event_id  result comment
## 4         2     NaN     bad 
## 
## df for event_id: 2 and comment: good:
##    event_id  result comment
## 2         2    15.0    good
## 3         2    11.0    good</code></pre>
<p>It seems that grouping only divides the dataset into subsets based on the argument <code>by</code> of the function.</p>
<p>But there is one minor issue with grouping: I often get frustrated with multiindexes, so I use <code>as_index=False</code></p>
<pre class="python"><code>grouped = df.groupby([&quot;event_id&quot;, &quot;comment&quot;], as_index=False)
for (event_id, comment), df_sub in grouped:
    print(f&quot;df for event_id: {event_id} and comment: {comment}:&quot;)
    print(df_sub, &quot;\n&quot;)</code></pre>
<pre><code>## df for event_id: 1 and comment: bad:
##    event_id  result comment
## 1         1    10.0     bad 
## 
## df for event_id: 1 and comment: good:
##    event_id  result comment
## 0         1    12.0    good 
## 
## df for event_id: 2 and comment: bad:
##    event_id  result comment
## 4         2     NaN     bad 
## 
## df for event_id: 2 and comment: good:
##    event_id  result comment
## 2         2    15.0    good
## 3         2    11.0    good</code></pre>
<p>that’s better.</p>
<p>When the data is grouped, we can easily obtain sizes/counts of each group. Counting can be done just like that:</p>
<pre class="python"><code>print(grouped.size(), &quot;\n&quot;)</code></pre>
<pre><code>##    event_id comment  size
## 0         1     bad     1
## 1         1    good     1
## 2         2     bad     1
## 3         2    good     2</code></pre>
<pre class="python"><code>print(grouped.count(), &quot;\n&quot;)  # excludes missing values - result for event 2 has count = 2</code></pre>
<pre><code>##    event_id comment  result
## 0         1     bad       1
## 1         1    good       1
## 2         2     bad       0
## 3         2    good       2</code></pre>
<pre class="python"><code>print(df.count(), &quot;\n&quot;)  # count() works also for the whole df</code></pre>
<pre><code>## event_id    5
## result      4
## comment     5
## dtype: int64</code></pre>
</div>
<div id="aggregating" class="section level3">
<h3>aggregating</h3>
<p><code>.agg</code> may be used for a dataframe or a groupby object. Here are some examples for a dataframe:</p>
<pre class="python"><code>print(df.agg(min), &quot;\n&quot;)</code></pre>
<pre><code>## event_id       1
## result      10.0
## comment      bad
## dtype: object</code></pre>
<pre class="python"><code>print(df.agg([min, max, &#39;mean&#39;, np.std]), &quot;\n&quot;)</code></pre>
<pre><code>##       event_id     result comment
## min   1.000000  10.000000     bad
## max   2.000000  15.000000    good
## mean  1.600000  12.000000     NaN
## std   0.547723   2.160247     NaN</code></pre>
<pre class="python"><code>print(df.agg({&#39;event_id&#39;: [&#39;max&#39;, &#39;mean&#39;], &#39;result&#39;: &#39;std&#39;}), &quot;\n&quot;)  # some funny formatting, different to the one returned by groupby.agg</code></pre>
<pre><code>##       event_id    result
## max        2.0       NaN
## mean       1.6       NaN
## std        NaN  2.160247</code></pre>
<p>and for grouped data</p>
<pre class="python"><code>grouped = df.groupby([&quot;event_id&quot;, &quot;comment&quot;])
print(grouped.agg(min), &quot;\n&quot;)</code></pre>
<pre><code>##                   result
## event_id comment        
## 1        bad        10.0
##          good       12.0
## 2        bad         NaN
##          good       11.0</code></pre>
<pre class="python"><code>print(grouped.agg([min, max, &#39;mean&#39;, np.std]), &quot;\n&quot;)
# useful for grouping many columns</code></pre>
<pre><code>##                  result                      
##                     min   max  mean       std
## event_id comment                             
## 1        bad       10.0  10.0  10.0       NaN
##          good      12.0  12.0  12.0       NaN
## 2        bad        NaN   NaN   NaN       NaN
##          good      11.0  15.0  13.0  2.828427</code></pre>
<pre class="python"><code>print(grouped.agg({&#39;result&#39;: [min, max, &#39;mean&#39;, np.std]}), &quot;\n&quot;)</code></pre>
<pre><code>##                  result                      
##                     min   max  mean       std
## event_id comment                             
## 1        bad       10.0  10.0  10.0       NaN
##          good      12.0  12.0  12.0       NaN
## 2        bad        NaN   NaN   NaN       NaN
##          good      11.0  15.0  13.0  2.828427</code></pre>
<p>As you can see, we obtained multiindexes in rows, which are IMHO redundant (they could be columns). Unfortunately <code>as_index=False</code> stops working when aggregating, but we can use .reset_index() instead.</p>
<pre class="python"><code>grouped = df.groupby([&quot;event_id&quot;, &quot;comment&quot;])
print(grouped.agg({&#39;result&#39;: [min, &#39;mean&#39;, np.std]}), &quot;\n&quot;)</code></pre>
<pre><code>##                  result                
##                     min  mean       std
## event_id comment                       
## 1        bad       10.0  10.0       NaN
##          good      12.0  12.0       NaN
## 2        bad        NaN   NaN       NaN
##          good      11.0  13.0  2.828427</code></pre>
<p>Besides, for many metrics we get a multicolumn index, which may be problematic, so it is a good idea to flatten it:</p>
<pre class="python"><code>res = grouped.agg([min, max, &#39;mean&#39;, np.std]).reset_index()
res.columns = [&quot;_&quot;.join(x) for x in res.columns.values]
print(res)</code></pre>
<pre><code>##    event_id_ comment_  result_min  result_max  result_mean  result_std
## 0          1      bad        10.0        10.0         10.0         NaN
## 1          1     good        12.0        12.0         12.0         NaN
## 2          2      bad         NaN         NaN          NaN         NaN
## 3          2     good        11.0        15.0         13.0    2.828427</code></pre>
<p>Lat but not least, you .agg can takes as arguments functions in various forms:</p>
<pre class="python"><code>def mad(x):
    &quot;&quot;&quot; mean absolut deviation of vector x &quot;&quot;&quot;
    return np.sum(np.abs(x - np.median(x))) / len(x)

functions = [min, &#39;max&#39;, &#39;std&#39;, np.median, lambda x: np.std(x) / np.mean(x), mad]
print(grouped.agg({&#39;result&#39;: functions}))</code></pre>
<pre><code>##                  result                                       
##                     min   max       std median &lt;lambda_0&gt;  mad
## event_id comment                                              
## 1        bad       10.0  10.0       NaN   10.0   0.000000  0.0
##          good      12.0  12.0       NaN   12.0   0.000000  0.0
## 2        bad        NaN   NaN       NaN    NaN        NaN  0.0
##          good      11.0  15.0  2.828427   13.0   0.153846  2.0</code></pre>
<p>To sum up, grouping and aggregating works a little like list comprehensions (do sth for each item) or map-reduce: <code>groupby</code> divides the dataset into items, and <code>agg</code> runs a function on each of the items.</p>
</div>
</div>
<div id="other-interesting-commandsarguments" class="section level2">
<h2>3. Other interesting commands/arguments:</h2>
<ul>
<li><a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.select_dtypes.html">select_dtypes</a>: <code>df.select_dtypes(include="object")</code> or <code>df.select_dtypes(exlude="object")</code> chooses onlt those columns, which fulfils criterium</li>
<li><a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.rename.html">rename</a>: <code>df.rename(columns={"current_name": "new_name", ...})</code> - instead of saying <code>rename(..., axis=1)</code>, you can say <code>df.rename(columns={...})</code>, which is a little bit more readable
`</li>
<li><p><a href="https://pandas.pydata.org/docs/user_guide/categorical.html">categorical data</a>: <code>df['some_class'].astype('category')</code> - keeping categorial data as <code>category</code> type is more memory-efficient, as values are stored as integers, and their names ar stored in something similar to a <code>dict</code></p></li>
<li><p><a href="https://pandas.pydata.org/docs/reference/api/pandas.Series.replace.html">replace - not str.replace</a>: <code>series.replace('other', 'unknown')</code> - exact synonym to <code>series.loc[series == "other"] = "unknown"</code>, but shorter, and you can also use regex like this: <code>pd.Series(["ab", "ac", "bc"]).replace("a.*", "zz", regex=True)</code>, which replaces <code>ab</code> and <code>ac</code> with <code>zz</code></p></li>
<li><p><a href="https://pandas.pydata.org/docs/reference/api/pandas.Series.str.get.html">str.get()</a>: <code>series.str.get(-1)</code> - gets the last element of an itarable object, which is <em>in</em> the series: if it is a string - takes the last letter, if a list/tuple - the last element of that list/tuple</p></li>
<li><p><a href="https://pandas.pydata.org/docs/reference/api/pandas.Series.str.split.html">str.split</a>: <code>series.str.split('_', n=2, expand=True)</code> - this command splits the strings by underscore, but only to the second (<code>n=2</code>) occurence of underscore, and <code>expand</code>s the result into several (in this case: 3) columns. An interesting variation of <code>expand</code> is <code>explode</code>: <code>series.explode()</code>, which converts a series of lists into a series by concatenating lists, so the result is a series, in opposite to <code>str.split(..., expand=True)</code>, where the result is a dataframe</p></li>
<li><p><a href="https://pandas.pydata.org/docs/reference/api/pandas.Series.str.replace.html">str.replace</a>: <code>series.str.replace("a.*", "zz", regex=True)</code> - replace everything that starts with <code>a</code> with <code>zz</code>; <code>regex=True</code> is mandatory in order to use regex</p></li>
<li><p><a href="https://pandas.pydata.org/docs/reference/api/pandas.Series.str.match.html">str.match</a>: <code>series.str.match("a.*")</code> - marks all the values that start with <code>a</code> as True, the rest is False. In contrast to <code>str.replace</code>, <code>str.match</code> uses rregex by default</p></li>
<li><p><a href="https://pandas.pydata.org/docs/reference/api/pandas.DataFrame.nlargest.html">nlargest</a>: <code>df.nlargest(5, columns="class1")</code> - returns 5 rows with the largest values of class1</p></li>
<li><p><a href="https://pandas.pydata.org/docs/reference/api/pandas.read_csv.html">read_csv</a>: <code>pd.read_csv</code> has milions of parameters, but one of them is particularily interesting: <code>pd.read_csv(..., dtype={"col1": int})</code>, which automatically reads the data in a proper format. This can be useful if you don’t vae an ORM to store information on data types, yet you want the columns to have proper dtypes, even if the whole column is empty (which may happen if you download data from spark)</p></li>
<li><p>axis: it is possible to write <code>axis=0</code> or <code>axis=1</code>, but <code>axis="rows"</code> and <code>axis="columns"</code> are much more readable</p></li>
</ul>
</div>
<div id="references" class="section level2">
<h2>4. References</h2>
<p>I highly recommend this book: <a href="https://www.manning.com/books/pandas-in-action">Pandas in action</a>, to all the readers.</p>
</div>

</div>

<div class="jumbotron text-center" id="footer">

  made using &emsp;
  <br class="d-xl-none">
  <a href="https://gohugo.io/">Hugo</a> |
  <a href="https://getbootstrap.com/">Bootstrap</a> |
  <a href="https://highlightjs.org/">highlightjs</a> |
  <a href="https://bookdown.org/yihui/blogdown/">blogdown</a> |
  <a href="https://fonts.google.com/">Google fonts</a> &emsp;
  <br class="d-xl-none">
  <a href="https://github.com/greysweater42/cookbook">github</a> |
  <a href="https://pages.github.com/">github pages</a> |
  <br>
  about me: <a href="https://www.linkedin.com/in/tomasz-dyrka-490766127/">LinkedIn</a>

</div>

</body>



<script src="https://greysweater42.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>


<script src="https://greysweater42.github.io/js/bootstrap-toc.js"></script>


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.js" integrity="sha384-9Nhn55MVVN0/4OFx7EE5kpFBPsEMZxKTCnA+4fqDmg12eCTqGi6+BB2LjY8brQxJ" crossorigin="anonymous"></script>

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>


<script>
$(window).scroll(function() {
  
  if ($(window).scrollTop() > 100 ) {
    $('.navbar').removeClass('navbar-hide');
    $('.navbar').addClass('navbar-show');
  } else {
    $('.navbar').removeClass('navbar-show');
    $('.navbar').addClass('navbar-hide');
  };   	
});
</script>

</html>

