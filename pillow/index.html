<!DOCTYPE html>
<html lang="en">
<head>

  <title>greysweater42&#39;s cookbook</title>
  <link rel="shortcut icon" type='image/x-icon' href="https://greysweater42.github.io/favicon.ico"/> 

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link href="https://fonts.googleapis.com/css?family=Ubuntu&display=swap" rel="stylesheet">        
  <link href="https://fonts.googleapis.com/css?family=Ubuntu+Mono&display=swap" rel="stylesheet">

  <link href="https://fonts.googleapis.com/css?family=Fascinate&display=swap" rel="stylesheet">

  
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">

  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
  
  
  <link rel="stylesheet" href="https://greysweater42.github.io/css/bootstrap-toc.css">

  
  <link rel="stylesheet" href="https://greysweater42.github.io/css/darcula.css">

  
  <link rel="stylesheet" href="https://greysweater42.github.io/css/style.css">

  
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-NNMCY8RRGL"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-NNMCY8RRGL');
  </script>

</head>


<body data-spy="scroll" data-target="#toc">



<nav id="navbar" class="navbar navbar-expand-md fixed-top navbar-hide transition">

  
  <a class="navbar-brand"></a>

  <button class="navbar-toggler float-xs-right" data-toggle="collapse" data-target="#collapsibleNavbar">
    Menu
  </button>

  <div class="collapse navbar-collapse" id="collapsibleNavbar">

    <ul class="navbar-nav">
      <li class="nav-item">
        <a class="nav-link" href="https://greysweater42.github.io">Home</a>
      </li>
      
      
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown">Python</a>
        <div class="dropdown-menu scrollable-menu">
          
            <a class="dropdown-item" href="https://greysweater42.github.io/airflow/">airflow</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/async_thread/">async/threads</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/beautiful_soup/">beautiful soup</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/decorators/">decorators</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/fastai/">fastai</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/flask/">flask</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/ggplot2/">ggplot2</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/keras/">keras</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/learning_tensorflow/">learning tensorflow</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/logging/">logging</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/pandas/">pandas</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/pillow/">pillow</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/pyenv/">pyenv, virtualenv, freeze</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/pytorch/">pytorch</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/pytorch_basics/">pytorch basics</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/spark/">spark</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/sqlalchemy/">sqlAlchemy</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/tensorflow/">tensorflow</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/testing/">testing</a>
          
        </div>
      </li>
    
      
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown">R</a>
        <div class="dropdown-menu scrollable-menu">
          
            <a class="dropdown-item" href="https://greysweater42.github.io/cinr/">C in R</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/classess4/">classes - S4</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/data.table/">data.table</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/debugging/">debugging</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/decision_trees/">decision trees</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/ggplot2/">ggplot2</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/logging/">logging</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/lubridate/">lubridate</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/nls/">nls</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/packages/">packages</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/rcpp/">Rcpp</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/reshape2/">reshape2</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/rmariadb/">RMariaDB (former RMySQL)</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/rocker/">rocker</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/rstanarm/">rstanarm</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/rtags/">rTags</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/shiny/">shiny</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/spark/">spark</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/sqldf/">sqldf</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/testing/">testing</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/tidyverse/">tidyverse</a>
          
        </div>
      </li>
    
      
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown">Machine learning</a>
        <div class="dropdown-menu scrollable-menu">
          
            <a class="dropdown-item" href="https://greysweater42.github.io/ml/">basic machine learning algorithms</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/bayes/">bayes</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/bias_variance/">bias/variance trade-off</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/cnns/">CNNs</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/decision_trees/">decision trees</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/fastai/">fastai</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/keras/">keras</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/learning_tensorflow/">learning tensorflow</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/validation/">model validation</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/nlp/">nlp</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/nls/">nls</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/pca/">PCA / SVD</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/pillow/">pillow</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/pytorch/">pytorch</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/pytorch_basics/">pytorch basics</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/tensorflow/">tensorflow</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/useful_processing/">useful processing</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/xai/">XAI</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/xgboost/">xgboost</a>
          
        </div>
      </li>
    
      
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown">Data engineering</a>
        <div class="dropdown-menu scrollable-menu">
          
            <a class="dropdown-item" href="https://greysweater42.github.io/airflow/">airflow</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/async_thread/">async/threads</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/hadoop/">hadoop</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/logging/">logging</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/pandas/">pandas</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/spark/">spark</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/useful_processing/">useful processing</a>
          
        </div>
      </li>
    
      
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown">DevOps</a>
        <div class="dropdown-menu scrollable-menu">
          
            <a class="dropdown-item" href="https://greysweater42.github.io/bash/">bash</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/docker/">docker</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/flask/">flask</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/git/">git</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/heroku/">heroku</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/mesos/">mesos</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/pyenv/">pyenv, virtualenv, freeze</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/rocker/">rocker</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/vagrant/">vagrant</a>
          
        </div>
      </li>
    
      
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown">Projects</a>
        <div class="dropdown-menu scrollable-menu">
          
            <a class="dropdown-item" href="https://greysweater42.github.io/fiat_ferrari/">fiat 126 v ferrari</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/finance_nn/">neural networks vs stock market</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/reading_mate/">reading mate</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/vim_vs_emacs/">vim vs emacs - text mining to settle the editor war</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/cookbook/">writing a cookbook</a>
          
        </div>
      </li>
    
      
      <li class="nav-item dropdown">
        <a class="nav-link dropdown-toggle" data-toggle="dropdown">scratchpad</a>
        <div class="dropdown-menu scrollable-menu">
          
            <a class="dropdown-item" href="https://greysweater42.github.io/passing_arguments/">passing arguments to scripts</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/redis/">redis</a>
          
            <a class="dropdown-item" href="https://greysweater42.github.io/tensorflow_serving/">tensorflow_serving</a>
          
        </div>
      </li>
    
    </ul>

  </div>  

</nav>



<div class="jumbotron text-center" id="header">

  <div id="header-title">
      <a href="https://greysweater42.github.io">greysweater42&#39;s cookbook</a>
  </div>

  <p style="color: white;">data science tutorials and snippets prepared by greysweater42</p> 

</div>


<nav id="toc" data-toggle="toc" class="sticky-top d-none d-xl-block"></nav>

<div class="article">

<div class="article-categories">
  
    <object style="vertical-align:middle" type="image/svg+xml" data="/folder.svg" height="15px" width="15px"></object> 
    <a href="https://greysweater42.github.io/categories/python" role="button">Python </a>
    &emsp;
  
    <object style="vertical-align:middle" type="image/svg+xml" data="/folder.svg" height="15px" width="15px"></object> 
    <a href="https://greysweater42.github.io/categories/machine-learning" role="button">Machine learning </a>
    &emsp;
  </br>
</div>
<div class="article-title">
  
  pillow

</div>
<div class="article-info">
    Nov 10, 2021 &emsp;  &emsp; 5 minutes read
</div>

<h2 id="1-what-is-pillow-and-why-would-you-use-it">1. What is <code>pillow</code> and why would you use it?</h2>
<p>Pillow is a Python package for working with images. It is invaluable for working with image datasets, but personally I find its API rather hard to remember, so here I present a few of the most popular applications of pillow for machine learning.</p>
<p>A quick note on installation:</p>
<pre><code class="language-{bash}" data-lang="{bash}">pip install pillow
</code></pre><h2 id="2-applications">2. Applications</h2>
<h3 id="a-displaying-an-image-in-a-vscode-interactive-session">a) displaying an image in a VSCode interactive session</h3>
<blockquote>
<p>IMHO VSCode provides the best environment for data scientists at the moment.</p>
</blockquote>
<p>This one is fairly straightforward:</p>
<pre><code class="language-{python}" data-lang="{python}">from PIL import Image
im = Image.open(&quot;image.jpg&quot;)
im
</code></pre><p>running simple <code>im</code> will display the image in the interactive session.
You can also run</p>
<pre><code class="language-{python}" data-lang="{python}">im.show()
</code></pre><p>which will open up a separate window with your image in it.</p>
<p>When you&rsquo;re done with looking at the image you should close it with:</p>
<pre><code class="language-{python}" data-lang="{python}">im.close()
</code></pre><p>which resembles working with files, but for them you usually use context managers (<code>with</code> statements). So to be always sure the image is closed you can run</p>
<pre><code class="language-{python}" data-lang="{python}">from IPython.display import display
from PIL import Image

with Image.open(&quot;image.jpg&quot;) as im:
    display(im)
</code></pre><p>but you have to specifically import <code>display</code> function, which will surely not be used in production.</p>
<h3 id="b-drawing-on-an-image">b) drawing on an image</h3>
<p>There are various shapes you can draw on an image, but the most commonly used are lines, rectangles, polygons and text.</p>
<pre><code class="language-{python}" data-lang="{python}">from PIL import Image, ImageDraw, ImageColor
from IPython.display import display
with Image.open(&quot;image.jpg&quot;) as im:
    # check your image type (im.type) to see if it is RGB or black and white
    # if your image is in black and white, you will not be able to draw in color
    im = im.convert('RGB')  
    draw = ImageDraw.Draw(im)  # a layer used for drawing
    coords = (0, 0, 100, 100) # (x1, y1, x2, y2)

    fill = ImageColor.getrgb(&quot;yellow&quot;)  # you can also provide rgb as e.g. #add8e6
    draw.line(coords, fill=fill, width=10)  # draw a line
    draw.rectangle(coords, fill=fill)  # draw a rectangle
    draw.rectangle(coords, outline=fill, width=4)  # draw a border of rectangle

    # polygon
    poly_coords = [(0, 0), (100, 100), (100, 200), (0, 100)]
    draw.polygon(poly_coords, fill=fill)

    # polygon border - you have to repeat the first coord
    draw.line(poly_coords + [poly_coords[0]], fill=&quot;black&quot;, width=10)  # draw a line

    # semi-transparent rectangle / polygon
    im = im.convert('RGBA')  
    overlay = Image.new('RGBA', im.size)
    draw = ImageDraw.Draw(overlay)
    draw.rectangle(coords, fill=(0, 0, 0, 127))
    draw.polygon(poly_coords, fill=(200, 100, 0, 127))
    im = Image.alpha_composite(im, overlay)
    im = im.convert('RGB')  # re-conversion to RGB may be needed for saving as jpg

    # text
    draw = ImageDraw.Draw(im)  # resetting draw after semi-transparent rectangle
    draw.text((50, 50), &quot;hello&quot;)
    display(im)

</code></pre><p>More about drawing you fill find in <a href="https://pillow.readthedocs.io/en/stable/reference/ImageDraw.html">pillow docs</a>.</p>
<h3 id="c-heatmap">c) heatmap</h3>
<p>Heatmap is in many cases a visual representation of a matrix. The higher the values of the matrix, the brighter the color, but you can also use different scales, e.g. when presenting temperature data, cold may be in blue, hot in red, and average in white.</p>
<p>In case of <code>pillow</code> there is no dedicated function to draw heatmaps, as it is e.g. in matplotlib, but you can easily create one, which draws a separate point for each value of the matrix on an empty canvas.</p>
<p>First, let&rsquo;s create a matrix. I will use a famous visual representation of <a href="https://en.wikipedia.org/wiki/Mandelbrot_set">Mandelbrot set</a>, which is a fascinating mathematical, well, miracle.</p>
<blockquote>
<p>If you want to dive deeper into things like <em>Mandelbrot set</em>, I highly recommend <em>Chaos</em> by James Gleick, which shortly explains how we can/should approach the fact, that 4 lines of simple code in Python can lead to infinite chaos and beauty.</p>
</blockquote>
<pre><code class="language-{python}" data-lang="{python}">import numpy as np


def define_frame(coords, resolution):
    re = np.linspace(coords[0][0], coords[0][1], resolution)
    im = np.linspace(coords[1][0] * 1j, coords[1][1] * 1j, resolution)
    x = re + im.reshape(1, -1).T
    return x


def mandelbrot(x):
    z = x ** 2 + x
    for _ in range(100):
        z = (z ** 2) + x
    return np.isnan(np.abs(z))


x = define_frame([(-2, 1), (-1.5, 1.5)], 1000)
man = mandelbrot(x)
</code></pre><p>And the pillow plotting function (brighter colors represent higher values, except for zeroes, which are black):</p>
<pre><code class="language-{python}" data-lang="{python}">from IPython.display import display
from PIL import Image, ImageDraw

with Image.new(&quot;RGB&quot;, man.shape, &quot;black&quot;) as im:
    draw = ImageDraw.Draw(im)
    # draw point takes coords as a list of tuples
    points = list(map(tuple, np.array(np.where(man))[::-1].T))
    draw.point(points, fill=&quot;white&quot;)
    display(im)
</code></pre><img src="https://greysweater42.github.io/pillow/black_white_pillow.png" style="width: 100%;"/>
<p>Of course you can also do this easily with matplotlib:</p>
<pre><code class="language-{python}" data-lang="{python}">import matplotlib.pyplot as plt
plt.imshow(man, cmap=&quot;hot&quot;, interpolation=&quot;nearest&quot;)
</code></pre><img src="https://greysweater42.github.io/pillow/black_white_matplotlib.png" style="width: 100%;"/>
<p>But we can go fancier with mandelbrot and add a parameter, which tells us&hellip; well, I&rsquo;m not going to explain here how the Mandelbrot set is created (even though is is surprisingly simple. IMHO, this simplicity is the most disturbing), let&rsquo;s just say that we add &ldquo;temperature&rdquo; to the plot.</p>
<pre><code class="language-{python}" data-lang="{python}">def mandelbrot_color(x):
    z = x ** 2 + x
    scores = np.zeros(x.shape)
    for n in range(100):
        z = (z ** 2) + x
        scores[(np.isnan(np.abs(z))) &amp; (scores == 0)] = n
    return scores


man_color = mandelbrot_color(x)

with Image.new(&quot;RGB&quot;, man_color.shape) as im:
    draw = ImageDraw.Draw(im)
    # draw point takes coords as a list of tuples
    scale = np.max(man_color)
    n = len(man_color)
    for i in range(n):
        for j in range(n):
            c = int(man_color[i,j] / scale * 255)
            # in RGB we give values to green and blue
            draw.point((j, i), fill=(0, c, c))  
    display(im)
</code></pre><img src="https://greysweater42.github.io/pillow/color_pillow.png" style="width: 100%;"/>
<p>And one can do this with matplotlib as well:</p>
<pre><code class="language-{python}" data-lang="{python}">import matplotlib.pyplot as plt
plt.imshow(man_color, cmap=&quot;hot&quot;, interpolation=&quot;nearest&quot;)
</code></pre><img src="https://greysweater42.github.io/pillow/color_matplotlib.png" style="width: 100%;"/>

</div>

<div class="jumbotron text-center" id="footer">

  made using &emsp;
  <br class="d-xl-none">
  <a href="https://gohugo.io/">Hugo</a> |
  <a href="https://getbootstrap.com/">Bootstrap</a> |
  <a href="https://highlightjs.org/">highlightjs</a> |
  <a href="https://bookdown.org/yihui/blogdown/">blogdown</a> |
  <a href="https://fonts.google.com/">Google fonts</a> &emsp;
  <br class="d-xl-none">
  <a href="https://github.com/greysweater42/cookbook">github</a> |
  <a href="https://pages.github.com/">github pages</a> |
  <br>
  about me: <a href="https://www.linkedin.com/in/tomasz-dyrka-490766127/">LinkedIn</a>

</div>

</body>



<script src="https://greysweater42.github.io/js/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>


<script src="https://greysweater42.github.io/js/bootstrap-toc.js"></script>


<script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.js" integrity="sha384-9Nhn55MVVN0/4OFx7EE5kpFBPsEMZxKTCnA+4fqDmg12eCTqGi6+BB2LjY8brQxJ" crossorigin="anonymous"></script>

<script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>


<script>
$(window).scroll(function() {
  
  if ($(window).scrollTop() > 100 ) {
    $('.navbar').removeClass('navbar-hide');
    $('.navbar').addClass('navbar-show');
  } else {
    $('.navbar').removeClass('navbar-show');
    $('.navbar').addClass('navbar-hide');
  };   	
});
</script>

</html>

